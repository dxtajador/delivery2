<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito | SpeedyDelivery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-light">

  <header class="bg-danger text-white p-3 mb-4 d-flex justify-content-between align-items-center">
    <h1 class="h3 m-0">Carrito</h1>
    <nav>
      <a href="/" class="btn btn-outline-light me-2">Inicio</a>
      <a href="/menu" class="btn btn-outline-light">Menú</a>
    </nav>
  </header>

  <main class="container">

    <h2 class="mb-4">Tu Carrito</h2>

    <div id="carrito-listado" class="list-group mb-4"></div>

    <h4>Dirección de entrega</h4>
    <input type="text" id="direccion" class="form-control mb-3" placeholder="Ingresa tu dirección" />

    <h4>Método de pago</h4>
    <select id="metodo-pago" class="form-select mb-3">
      <option value="tarjeta">Tarjeta de crédito/débito</option>
      <option value="efectivo">Efectivo</option>
      <option value="paypal">PayPal</option>
    </select>

    <button id="btn-confirmar" class="btn btn-danger btn-lg w-100">Confirmar pedido</button>

  </main>

  <footer class="bg-dark text-white text-center p-3 mt-5">
    <small>© 2025 SpeedyDelivery - Todos los derechos reservados</small>
  </footer>

  <script>
    const carritoListado = document.getElementById('carrito-listado');
    const direccionInput = document.getElementById('direccion');
    const btnConfirmar = document.getElementById('btn-confirmar');

    // Cargar carrito y dirección desde localStorage
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    direccionInput.value = localStorage.getItem('direccion') || '';

    function renderizarCarrito() {
      carritoListado.innerHTML = '';

      if (carrito.length === 0) {
        carritoListado.innerHTML = '<p class="text-muted">Tu carrito está vacío.</p>';
        btnConfirmar.disabled = true;
        return;
      }

      btnConfirmar.disabled = false;

      carrito.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'list-group-item d-flex justify-content-between align-items-center flex-wrap';

        itemDiv.innerHTML = `
          <div class="flex-grow-1">
            <h5>${item.nombre}${item.opcion ? ' - ' + item.opcion : ''}</h5>
            <p class="mb-1">Precio unitario: $${item.precio.toFixed(2)}</p>
            <div class="input-group input-group-sm" style="max-width: 120px;">
              <span class="input-group-text">Cantidad</span>
              <input type="number" min="1" class="form-control cantidad-input" data-index="${index}" value="${item.cantidad}" />
            </div>
            <p class="mt-1 mb-0">Subtotal: $${(item.precio * item.cantidad).toFixed(2)}</p>
          </div>
          <button class="btn btn-outline-danger btn-sm eliminar-btn" data-index="${index}">Eliminar</button>
        `;

        carritoListado.appendChild(itemDiv);
      });
    }

    // Actualiza la cantidad en carrito
    carritoListado.addEventListener('input', e => {
      if (e.target.classList.contains('cantidad-input')) {
        const idx = e.target.getAttribute('data-index');
        let val = parseInt(e.target.value);
        if (val < 1) val = 1;
        carrito[idx].cantidad = val;
        localStorage.setItem('carrito', JSON.stringify(carrito));
        renderizarCarrito();
      }
    });

    // Eliminar producto
    carritoListado.addEventListener('click', e => {
      if (e.target.classList.contains('eliminar-btn')) {
        const idx = e.target.getAttribute('data-index');
        carrito.splice(idx, 1);
        localStorage.setItem('carrito', JSON.stringify(carrito));
        renderizarCarrito();
      }
    });

    // Guardar dirección al escribir
    direccionInput.addEventListener('change', () => {
      localStorage.setItem('direccion', direccionInput.value.trim());
    });

    btnConfirmar.addEventListener('click', () => {
      if (!direccionInput.value.trim()) {
        alert('Por favor ingresa una dirección de entrega.');
        direccionInput.focus();
        return;
      }
      if (carrito.length === 0) {
        alert('Tu carrito está vacío.');
        return;
      }
      // Aquí se podría enviar el pedido al backend

      alert('¡Pedido confirmado! Gracias por tu compra.');
      carrito = [];
      localStorage.removeItem('carrito');
      renderizarCarrito();
    });

    renderizarCarrito();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
